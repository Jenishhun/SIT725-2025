'use strict';

const modifiedPaths = require('./modifiedPaths');

module.exports = function updatedPathsByArrayFilter(update) {
<<<<<<< HEAD
=======
  if (update == null) {
    return {};
  }
>>>>>>> 14215a1931df15106c4f78764ec98b5fa8960ef2
  const updatedPaths = modifiedPaths(update);

  return Object.keys(updatedPaths).reduce((cur, path) => {
    const matches = path.match(/\$\[[^\]]+\]/g);
    if (matches == null) {
      return cur;
    }
    for (const match of matches) {
      const firstMatch = path.indexOf(match);
      if (firstMatch !== path.lastIndexOf(match)) {
        throw new Error(`Path '${path}' contains the same array filter multiple times`);
      }
      cur[match.substring(2, match.length - 1)] = path.
<<<<<<< HEAD
        substr(0, firstMatch - 1).
=======
        substring(0, firstMatch - 1).
>>>>>>> 14215a1931df15106c4f78764ec98b5fa8960ef2
        replace(/\$\[[^\]]+\]/g, '0');
    }
    return cur;
  }, {});
<<<<<<< HEAD
};
=======
};
>>>>>>> 14215a1931df15106c4f78764ec98b5fa8960ef2
